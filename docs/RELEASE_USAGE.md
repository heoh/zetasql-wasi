# ZetaSQL WASI Release Usage Guide

This guide explains how to use the ZetaSQL WASI release artifacts.

## Release Artifacts

The `release/` directory contains distribution-ready artifacts generated by `./scripts/prepare_release.sh`:

### 1. `zetasql.wasm`

The optimized WebAssembly binary of ZetaSQL Local Service, compiled with WASI support.

**Usage:**
- Load this WASM module using any WASI-compatible runtime.
- The module implements the ZetaSQL Local Service RPC interface.
- You need to implement a wrapper in your target language to call the WASM exports (malloc, free, and RPC methods).

### 2. `zetasql-proto.tar.gz`

Collection of Protocol Buffer definition files for ZetaSQL APIs.

**Contents:**
- `zetasql/local_service/` - RPC service definitions
- `zetasql/parser/` - AST and parser protos (includes generated files)
- `zetasql/resolved_ast/` - Resolved AST protos (includes generated files)
- `zetasql/proto/` - Core ZetaSQL protos
- `zetasql/public/` - Public API protos

**Usage:**
Extract and use with `protoc` to generate language-specific code for your wrapper package.

### 3. Checksum Files

- `zetasql.wasm.sha256`
- `zetasql-proto.tar.gz.sha256`

**Verify integrity:**
```bash
cd release/
sha256sum -c *.sha256
```

## Integration Steps

1. **Extract Protos**: Extract `zetasql-proto.tar.gz` to get the `.proto` files.
2. **Generate Code**: Use `protoc` to generate code for your target language.
3. **Load WASM**: Use a WASM runtime to load `zetasql.wasm`.
4. **Implement Wrapper**: Create a client that serializes protos, writes to WASM memory, calls the RPC export, and reads the result.

## WASM Runtime Requirements

- **WASI preview1** support.
- **Memory**: At least 256MB available heap.
- **Threads**: Thread support enabled (wasm32-threads).
- **Environment**: Optional timezone support via `/usr/share/zoneinfo` mapping.

## Version Information

- **ZetaSQL Version**: See `ZETASQL_VERSION` in project root.
- **Patches Applied**: 20 WASI-specific patches (see `patches/` directory).
- **Build Process**: Built with `scripts/build.sh` + `scripts/prepare_release.sh`.

## License

ZetaSQL is licensed under Apache License 2.0. See the upstream repository for details:
https://github.com/google/zetasql

## Support & Issues

- **WASI compilation/patches**: Open an issue in the zetasql-wasi repository.
- **ZetaSQL core functionality**: Refer to the upstream ZetaSQL repository.
