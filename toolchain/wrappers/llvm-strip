#!/bin/bash
# Wrapper script for llvm-strip in WASI SDK
# Handles both bzlmod (+_repo_rules+) and legacy (wasi_sdk) paths

# Try known bzlmod/legacy layouts in order
for candidate in \
    "external/zetasql_wasi_toolchain~~_repo_rules~wasi_sdk" \
    "external/_main~_repo_rules~wasi_sdk" \
    "external/+_repo_rules+wasi_sdk" \
    "external/wasi_sdk"
do
    if [ -d "$candidate" ]; then
        WASI_SDK_DIR="$candidate"
        break
    fi
done

if [ -z "${WASI_SDK_DIR:-}" ]; then
    echo "WASI SDK not found in expected external paths" >&2
    exit 1
fi

exec "$WASI_SDK_DIR/bin/llvm-strip" "$@"
